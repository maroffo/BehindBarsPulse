{% if results %}
<div class="search-results">
    <p class="results-count">{{ total }} risultat{% if total == 1 %}o{% else %}i{% endif %} trovat{% if total == 1 %}o{% else %}i{% endif %}</p>

    <div class="results-list" id="results-list">
        {% for result in results %}
        {% if result.result_type == 'article' %}
        <article class="result-card result-card--article">
            <div class="result-header">
                {% if result.article.category %}
                <span class="article-category">{{ result.article.category }}</span>
                {% endif %}
                <span class="result-type-badge">Articolo</span>
                <span class="similarity-score" title="Rilevanza: {{ (result.similarity * 100) | round(1) }}%">
                    {{ (result.similarity * 100) | round | int }}% correlato
                </span>
            </div>
            <h2 class="result-title">
                <a href="/article/{{ result.article.id }}">{{ result.article.title }}</a>
            </h2>
            <p class="article-meta">
                {% if result.article.author %}<span class="author">{{ result.article.author }}</span>{% endif %}
                {% if result.article.author and result.article.source %} · {% endif %}
                {% if result.article.source %}<span class="source">{{ result.article.source }}</span>{% endif %}
                {% if result.article.published_date %}
                · <time>{{ result.article.published_date.strftime('%d/%m/%Y') }}</time>
                {% endif %}
            </p>
            {% if result.article.summary %}
            <p class="result-summary">{{ result.article.summary }}</p>
            {% endif %}
        </article>
        {% elif result.result_type == 'editorial' %}
        <article class="result-card result-card--editorial">
            <div class="result-header">
                <span class="result-type-badge result-type-badge--editorial">
                    {% if result.comment.source_type == 'bulletin' %}Bollettino{% else %}Newsletter{% endif %}
                </span>
                <span class="similarity-score" title="Rilevanza: {{ (result.similarity * 100) | round(1) }}%">
                    {{ (result.similarity * 100) | round | int }}% correlato
                </span>
            </div>
            <h2 class="result-title">
                {% if result.comment.source_type == 'bulletin' %}
                <a href="/bollettino/{{ result.comment.source_date.strftime('%Y-%m-%d') }}">
                    Bollettino del {{ result.comment.source_date.strftime('%d/%m/%Y') }}
                </a>
                {% else %}
                <a href="/archive/{{ result.comment.source_date.strftime('%Y-%m-%d') }}">
                    Newsletter del {{ result.comment.source_date.strftime('%d/%m/%Y') }}
                </a>
                {% endif %}
            </h2>
            <p class="result-summary">{{ result.comment.content[:300] }}{% if result.comment.content|length > 300 %}...{% endif %}</p>
        </article>
        {% endif %}
        {% endfor %}
    </div>

    {% if has_more %}
    <div id="load-more-container">
        <button class="load-more-btn"
                hx-get="/search/results?q={{ query | urlencode }}&offset={{ next_offset }}&content_type={{ content_type }}"
                hx-target="#load-more-container"
                hx-swap="outerHTML"
                hx-indicator="#load-more-spinner">
            Carica altri risultati
        </button>
        <span id="load-more-spinner" class="htmx-indicator">Caricamento...</span>
    </div>
    {% endif %}
</div>
{% elif query %}
<div class="no-results">
    <p>Nessun risultato trovato per "{{ query }}".</p>
    <p class="no-results-hint">Prova con termini diversi o più generici.</p>
</div>
{% else %}
<div class="search-placeholder">
    <p>Inserisci una query per cercare negli articoli e nei commenti editoriali.</p>
</div>
{% endif %}
