{% extends "base.html" %}

{% block title %}{{ article.title }} - BehindBars{% endblock %}

{% block content %}
<article class="article-single">
    <nav class="breadcrumb">
        <a href="/articles">← Tutti gli articoli</a>
    </nav>

    <header class="article-header">
        <div class="article-meta-top">
            {% if article.category %}
            <span class="article-category">{{ article.category }}</span>
            {% endif %}
            {% if article.importance %}
            <span class="article-importance importance-{{ article.importance | lower }}">
                {{ article.importance }}
            </span>
            {% endif %}
        </div>

        <h1 class="article-title">{{ article.title }}</h1>

        <div class="article-meta">
            {% if article.author %}<span class="author">{{ article.author }}</span>{% endif %}
            {% if article.author and article.source %} · {% endif %}
            {% if article.source %}<span class="source">{{ article.source }}</span>{% endif %}
            {% if article.published_date %}
            · <time datetime="{{ article.published_date }}">{{ article.published_date.strftime('%d %B %Y') }}</time>
            {% endif %}
        </div>
    </header>

    {% if article.summary %}
    <section class="article-summary-box">
        <h2>Riassunto</h2>
        <p>{{ article.summary }}</p>
    </section>
    {% endif %}

    <section class="article-cta">
        <a href="{{ article.link }}" class="btn btn-primary btn-large" target="_blank" rel="noopener">
            Leggi l'articolo completo su {{ article.source or 'fonte originale' }} →
        </a>
        {% if article.wayback_url %}
        <a href="{{ article.wayback_url }}" class="btn btn-outline" target="_blank" rel="noopener">
            Versione archiviata
        </a>
        {% endif %}
    </section>

    {% if related_articles %}
    <section class="related-articles">
        <h2>Articoli correlati</h2>
        <div class="results-list">
            {% for related in related_articles %}
            <article class="result-card result-card--article">
                <div class="result-header">
                    {% if related.category %}
                    <span class="article-category">{{ related.category }}</span>
                    {% endif %}
                    {% if related.similarity %}
                    <span class="similarity-score" title="Rilevanza: {{ (related.similarity * 100) | round(1) }}%">
                        {{ (related.similarity * 100) | round | int }}% correlato
                    </span>
                    {% endif %}
                </div>
                <h3 class="result-title">
                    <a href="/article/{{ related.id }}">{{ related.title }}</a>
                </h3>
                <p class="article-meta">
                    {% if related.author %}<span class="author">{{ related.author }}</span>{% endif %}
                    {% if related.author and related.source %} · {% endif %}
                    {% if related.source %}<span class="source">{{ related.source }}</span>{% endif %}
                    {% if related.published_date %}
                    · <time>{{ related.published_date.strftime('%d/%m/%Y') }}</time>
                    {% endif %}
                </p>
                {% if related.summary %}
                <p class="result-summary">{{ related.summary }}</p>
                {% endif %}
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</article>
{% endblock %}
